version: 2

models:
    - name: dmrp_map_extract
      description: >
        accumulating snapshot of medication level MAP data sent to client weekly

      columns:
        - name: institution_id
          description: >
            unique id for client institution
          tests:
            - not_null

        - name: patient_id
          description: >
            Cureatr generated unique id for a patient not required for this report used for testing
          tests:
            - not_null

        - name: opportunity_id
          description: >
            unique id generated for each opportunity to service a patient not required for this report used for testing
          tests:
            - not_null

        - name: patient_med_problems_id
          description: >
            unique_id associated with a specific problem related to a specific medication identified for a specific patient.
            Not a required field for this report this is used to test the granularity of the dataset
          tests:
            - unique

        - name: primary_patient_id
          description: >
            unique patient id provided by client
          tests:
            - not_null

        - name: secondary_patient_id
          description: >
            unique secondary patient id provided by client

        - name: patient_name
          description: >
            patient's full name
          tests:
            - not_null

        - name: date_of_birth
          description: >
            patient's date of birth
          tests:
            - not_null
            - dbt_expectations.expect_column_values_to_be_of_type:
                column_type: date

        - name: pcp_name
          description: >
            Name of patient's primary care provider
          tests:
            - not_null

        - name: discharge_date
          description: >
              date patient was discharged from the hospital
          tests:
            - not_null
            - dbt_expectations.expect_column_values_to_be_of_type:
                column_type: date

        - name: discharge_facility
          description: >
            Name of facility patient was discharged from generating the opportunity for service
          tests:
            - not_null

        - name: mrp_date
          description: >
              date patient's desktop MRP was completed
          tests:
            - not_null
            - dbt_expectations.expect_column_values_to_be_of_type:
                column_type: date

        - name: mrp_completed_by
          description: >
            Name of Cureatr staff member who completed patient's desktop MRP
          tests:
            - not_null

        - name: mrp_co_signed_by
          description: >
            Name of Cureatr PharmD who co-signed medlist if required

        - name: provider_summary
          description: >
            The overall summary to the provider from the MAP

        - name: medication_name
          description: >
            Name of medication providing the full_gpi_name including strength
          tests:
            - not_null

        - name: status
          description: >
            status of the medication
          tests:
            - not_null

        - name: instructions
          description: >
            instructions for taking the medication

        - name: medication_taken_for
          description: >
            reason for taking the medication

        - name: problem
          description: >
            problem with medication identified through MRP

        - name: patient_recommendation
          description: >
            medication recommendation for the patient

        - name: provider_recommendation
          description: >
            medication recommendation for the provider

        - name: interventions
          description: >
            interventions recommended if a problem is identified

        - name: prescriber
          description: >
            name of provider who prescribed medication
#          tests:
#            - not_null

      tests:
        - dbt_expectations.expect_column_pair_values_A_to_be_greater_than_B:
            column_A: mrp_date
            column_B: discharge_date
            or_equal: True

version: 2

models:
    - name: bcbsm_supplemental_file
      description: >
        monthly supplemental file sent to BCBSM.  Must match billing report med list for med list.
      columns:
        - name: "(MemberKey || '-' || DOS)"
          description: >
            unique id associated with MRP visit generated by salesforce
          tests:
            - unique
            - dbt_utils.relationships_where:
                to: ref('advantasure_billing')
                field: "(source_patient_id || '-' || mrp_visit_date::date)"
                to_condition: map_transmission_date between date_trunc('month', current_date) - interval '1 month' and date_trunc('month', current_date) - interval '1 second'
            - not_null

        - name: ProviderType
          description: >
            static field that should always have the value "RPH"
          tests:
            - not_null
            - accepted_values:
                values: ["RPH"]

        - name: CPTPx
          description: >
            static field that should always have the value "1111F"
          tests:
            - not_null
            - accepted_values:
                values: [ "1111F" ]

        - name: ICDDX10
          description: >
            static field that should always have the value "Z7189"
          tests:
            - not_null
            - accepted_values:
                values: [ "Z7189" ]

        - name: RxProviderFlag
          description: >
            static field that should always have the value "0"
          tests:
            - not_null
            - accepted_values:
                values: [ "0" ]

        - name: PCPFlag
          description: >
            static field that should always have the value "0"
          tests:
            - not_null
            - accepted_values:
                values: [ "0" ]

        - name: SuppSource
          description: >
            static field that should always have the value "M"
          tests:
            - not_null
            - accepted_values:
                values: [ "M" ]

        - name: ProviderKey
          description: >
            npi of the pharmacist who authored or co-authored the map
          tests:
            - not_null

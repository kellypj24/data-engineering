version: 2

models:
  - name: stg_example
    description: Staged orders with cleaned strings and audit columns
    columns:
      - name: order_id
        description: Primary key
        tests:
          - unique
          - not_null
      - name: status
        description: Cleaned order status (lowercase, trimmed, nullified if empty)
      - name: amount
        description: Order amount
      - name: created_at
        description: Order creation timestamp
      - name: _loaded_at
        description: Timestamp when this row was first loaded into the warehouse by the EL tool
      - name: _dbt_updated_at
        description: Timestamp when this row was last processed by dbt

unit_tests:
  - name: test_stg_example_cleans_strings
    description: Verify that string cleaning works correctly
    model: stg_example
    given:
      - input: source('raw', 'orders')
        rows:
          - {id: 1, status: "  ACTIVE  ", amount: 100, created_at: "2024-01-01"}
          - {id: 2, status: "", amount: 200, created_at: "2024-01-02"}
          - {id: 3, status: " Pending ", amount: 0, created_at: "2024-01-03"}
    expect:
      rows:
        - {order_id: 1, status: "active", amount: 100}
        - {order_id: 2, status: null, amount: 200}
        - {order_id: 3, status: "pending", amount: 0}
